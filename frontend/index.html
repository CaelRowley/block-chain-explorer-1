<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Block Chain Explorer</title>
   </head>

   <body>
      <h1>Blocks</h1>
      <a href="./witnesses.html">Blocks</a>

      <div id="input">
          <label for"search">Search: </label>
          <input type="text" id="search"/>
          <input type="radio" name="type" id="type" value="blocks" checked> Blocks
          <input type="radio" name="type" id="type" value="witnesses" checked> Witnesses
          <input type="radio" name="type" id="type" value="addresses" checked> Addresses
          <input type="submit" onclick="doSearch(document.getElementById('search').value, getRadioButtonValue('type'));"/>
      </div>

      <div id="searchCount"></div>
      <div id="searchResult"></div>

      <script type="application/javascript">
         function doSearch (filter, type) {
            var elasticsearchHost = 'http://localhost:9200/_search';

            var body = {
               'size': 100
            };
            var query = {
               'bool': {}
            };

            if (filter.length > 0) {
               query.bool.must = {
                  'multi_match': {
                     'query': filter,
                     'fields': [ '_id' ]
                  }
               };
            }
            if (type.length > 0) {
               query.bool.filter = {
                  'multi_match': {
                     'query': type,
                     'fields': [ '_index' ]
                  }
               };
            }
            body.query = query;

            var xmlHttpRequest = new XMLHttpRequest();
            xmlHttpRequest.open('POST', elasticsearchHost, false);
            xmlHttpRequest.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
            xmlHttpRequest.send(JSON.stringify(body));
            var response = JSON.parse(xmlHttpRequest.responseText);

            var output = '';

            if(type === 'blocks'){
               for (var i = 0; i < response.hits.hits.length; i++) {
                  output += '<h2>' + "BLOCK: " + response.hits.hits[i]._id + '</h2>';
                  output += "parentHash: " + response.hits.hits[i]._source.parentHash + '</br>';
                  output += "witnessAddress: " + response.hits.hits[i]._source.witnessAddress + '</br>';
                  output += "transactionsCount: " + response.hits.hits[i]._source.transactionsCount + '</br>';

                  if(response.hits.hits[i]._source.transactions){
                     output += "transactions: " + '</br>';
                     for(var j in response.hits.hits[i]._source.transactions){
                        output += "___transaction " + j + "___" + '</br>';
                        output += " - fromAddress: " + response.hits.hits[i]._source.transactions[j].fromaddress + '</br>';
                        output += " - toAddress: " + response.hits.hits[i]._source.transactions[j].toaddress + '</br>';
                        output += " - amount: " + response.hits.hits[i]._source.transactions[j].amount + '</br>';
                     }
                  }
               }
           } else if(type === 'witnesses'){
               for (var i = 0; i < response.hits.hits.length; i++) {
                  output += '<h2>' + "WITNESS: " + response.hits.hits[i]._id + '</h2>';
                  output += "address: " + response.hits.hits[i]._source.address + '</br>';
                  output += "voteCount: " + response.hits.hits[i]._source.votecount + '</br>';
                  output += "pubKey: " + response.hits.hits[i]._source.pubkey + '</br>';
                  output += "url: " + response.hits.hits[i]._source.url + '</br>';
                  output += "totalMissed: " + response.hits.hits[i]._source.totalmissed + '</br>';
                  output += "latestBlockNum: " + response.hits.hits[i]._source.latestblocknum + '</br>';
                  output += "latestSlotNum: " + response.hits.hits[i]._source.latestslotnum + '</br>';
                  output += "isJobs: " + response.hits.hits[i]._source.isjobs + '</br>';
               }
           } else if(type === 'addresses'){
               for (var i = 0; i < response.hits.hits.length; i++) {
                  output += '<h2>' + "ADDRESS: " + response.hits.hits[i]._id + '</h2>';
                  output += "address: " + response.hits.hits[i]._source.address + '</br>';
               }
            }
            document.getElementById('searchCount').innerHTML = '<h2>Showing ' + response.hits.hits.length + ' results</h2>';
            document.getElementById('searchResult').innerHTML = output;
         }

         function getRadioButtonValue (name) {
            var radios = document.getElementsByName(name);
            for (var i = 0, length = radios.length; i < length; i++) {
               if (radios[i].checked) {
                  return radios[i].value;
               }
            }
            return '';
         }
         doSearch('','blocks');
      </script>
   </body>
</html>
