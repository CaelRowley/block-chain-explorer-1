<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Block Chain Explorer</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
   </head>
   
   <body class="container">

      <div class="jumbotron">
         <h1>Witnesses</h1>
         <a href="./index.html">Blocks</a>
         <div id="input">
             <label> Search: </label>
             <input type="text" class="form-control" id="search"/>
             </br>
             <div>
                <ul class="col-md-6">
                   <input class="" type="radio" name="type" id="type" value="address" checked> address </br>
                   <input class="" type="radio" name="type" id="type" value="votecount" checked> voteCount </br>
                   <input class="" type="radio" name="type" id="type" value="pubkey" checked> pubKey </br>
                   <input class="" type="radio" name="type" id="type" value="url" checked> url </br>
                </ul>
                <ul class="col-md-6">
                   <input class="" type="radio" name="type" id="type" value="totalmissed" checked> totalMissed </br>
                   <input class="" type="radio" name="type" id="type" value="latestblocknum" checked> latestblocknum </br>
                   <input class="" type="radio" name="type" id="type" value="latestslotnum" checked> latestSlotNum </br>
                   <input class="" type="radio" name="type" id="type" value="isjobs" checked> isJobs </br>
                </ul>
             </div>
         </div>
         
         <input class="btn btn-primary" type="submit" onclick="doSearch(document.getElementById('search').value, getRadioButtonValue('type'), 'witnesses');"/>
         
         <div id="searchCount"></div>
      </div>

      <div id="searchResult"></div>

      <script type="application/javascript">

         function doSearch (filter, field, type) {
            var elasticsearchHost = 'http://localhost:9200/_search';

            var body = {
               'size': 100
            };

            var query = {
               'bool': {}
            };

            if (type.length > 0) {
               query.bool.must = [
                  {'multi_match': {
                     'query': type,
                     'fields': [ '_index' ]
                  }}
               ]
            }

            if(filter.length > 0 && field.length>0){
               var filterAndField = { 'multi_match' : {'query' : filter, 'fields' : [ field ]}}
               query.bool.must.push(filterAndField);
            }

            body.query = query;

            $.ajax({
               url: elasticsearchHost,
               headers: {
                  'Content-Type':'application/json;charset=UTF-8',
               },
               method: 'POST',
               dataType: 'json',
               data: JSON.stringify(body),
               success: function(response){
                  console.log('success: '+ response);
                  var output = '';
                  for (var i = 0; i < response.hits.hits.length; i++) {
                     output += '<div class="jumbotron panel-default">'
                     output += '<h2>' + "WITNESS: " + response.hits.hits[i]._id + '</h2>';
                     output += '<ul>'
                     output += "<li>address: " + response.hits.hits[i]._source.address + '</li></br>';
                     output += "<li>voteCount: " + response.hits.hits[i]._source.votecount + '</li></br>';
                     output += "<li>pubKey: " + response.hits.hits[i]._source.pubkey + '</li></br>';
                     output += "<li>url: " + response.hits.hits[i]._source.url + '</li></br>';
                     output += "<li>totalMissed: " + response.hits.hits[i]._source.totalmissed + '</li></br>';
                     output += "<li>latestBlockNum: " + response.hits.hits[i]._source.latestblocknum + '</li></br>';
                     output += "<li>latestSlotNum: " + response.hits.hits[i]._source.latestslotnum + '</li></br>';
                     output += "<li>isJobs: " + response.hits.hits[i]._source.isjobs + '</li></br>';
                     output += '</ul>';
                     output += '</div>';
                  }
                  document.getElementById('searchCount').innerHTML = '<h2>Showing ' + response.hits.hits.length + ' results</h2>';
                  document.getElementById('searchResult').innerHTML = output;
               }
            });
         }

         function getRadioButtonValue (name) {
            var radios = document.getElementsByName(name);
            for (var i = 0, length = radios.length; i < length; i++) {
               if (radios[i].checked) {
                  return radios[i].value;
               }
            }
            return '';
         }

         doSearch("", "", "witnesses");

         

         // $.post(elasticsearchHost, JSON.stringify(body), function(result){
         //    console.log(result)
         // });
      </script>
   </body>
</html>
